From 0d4c03239ef08e78631ab2d6f5984096780c9aaf Mon Sep 17 00:00:00 2001
From: Ghennadi Procopciuc <ghennadi.procopciuc@nxp.com>
Date: Thu, 12 Jan 2023 10:34:47 +0200
Subject: [PATCH 29/63] dts/freescale: Add nodes for SRC module found on S32CC
 SoCs

Issue: ALB-9261
Upstream-Status: Pending 

Signed-off-by: Ghennadi Procopciuc <ghennadi.procopciuc@nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 arch/arm64/boot/dts/freescale/s32cc.dtsi  | 15 +++++++++++++++
 arch/arm64/boot/dts/freescale/s32g.dtsi   | 13 ++++++++++++-
 arch/arm64/boot/dts/freescale/s32r45.dtsi | 10 ++++++++++
 3 files changed, 37 insertions(+), 1 deletion(-)

diff --git a/arch/arm64/boot/dts/freescale/s32cc.dtsi b/arch/arm64/boot/dts/freescale/s32cc.dtsi
index afca4a352c69..d0db16c108de 100644
--- a/arch/arm64/boot/dts/freescale/s32cc.dtsi
+++ b/arch/arm64/boot/dts/freescale/s32cc.dtsi
@@ -244,6 +244,21 @@ rtc0: rtc@40060000 {
 			nxp,dividers = <1 0>; // div512 enabled; div32 disabled
 		};
 
+		src: syscon@4007c000 {
+			compatible = "syscon", "simple-mfd";
+			reg = <0x0 0x4007c000 0x0 0x100>;
+			#address-cells = <1>;
+			#size-cells = <1>;
+			ranges = <0x0 0x0 0x4007c000 0x100>;
+
+			can_ts_ctrl: mux-controller@f0 {
+				compatible = "mmio-mux";
+				reg = <0xf0 0x4>;
+				mux-reg-masks = <0xf0 0x7>;
+				status = "disabled";
+			};
+		};
+
 		ddr_gpr: ddr_gpr@4007c600 {
 			compatible = "nxp,s32cc-ddr-gpr", "syscon";
 			reg = <0x0 0x4007c600 0x0 0x20>;
diff --git a/arch/arm64/boot/dts/freescale/s32g.dtsi b/arch/arm64/boot/dts/freescale/s32g.dtsi
index de9caffb3ca1..820167a32157 100644
--- a/arch/arm64/boot/dts/freescale/s32g.dtsi
+++ b/arch/arm64/boot/dts/freescale/s32g.dtsi
@@ -1,6 +1,6 @@
 // SPDX-License-Identifier: GPL-2.0
 /*
- * Copyright 2019-2022 NXP
+ * Copyright 2019-2023 NXP
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -11,6 +11,7 @@
 #include "s32cc.dtsi"
 #include "s32g-pfe.dtsi"
 #include <dt-bindings/mailbox/nxp-llce-mb.h>
+#include <dt-bindings/mux/nxp-s32g-can-ts.h>
 
 / {
 	reserved-memory {
@@ -985,3 +986,13 @@ &stm0 {
 &stm1 {
 	status = "okay";
 };
+
+/* Used for FlexCAN and LLCE CAN timestamping */
+&stm7 {
+	status = "okay";
+};
+
+&can_ts_ctrl {
+	idle-states = <S32G_CAN_TS_STM7>;
+	status = "okay";
+};
diff --git a/arch/arm64/boot/dts/freescale/s32r45.dtsi b/arch/arm64/boot/dts/freescale/s32r45.dtsi
index d0cd3164fc02..c420fab5f9a5 100644
--- a/arch/arm64/boot/dts/freescale/s32r45.dtsi
+++ b/arch/arm64/boot/dts/freescale/s32r45.dtsi
@@ -10,6 +10,7 @@
 
 #include "s32cc.dtsi"
 #include <dt-bindings/clock/s32r45-scmi-clock.h>
+#include <dt-bindings/mux/nxp-s32r45-can-ts.h>
 
 / {
 	compatible = "nxp,s32r45";
@@ -290,3 +291,12 @@ &pcie1 {
 &tmu {
 	compatible = "nxp,s32r45-tmu";
 };
+
+/* Used for FlexCAN timestamping */
+&stm7 {
+	status = "okay";
+};
+
+&can_ts_ctrl {
+	idle-states = <S32R45_CAN_TS_STM7>;
+};
-- 
2.25.1

