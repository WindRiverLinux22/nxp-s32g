From 1461d2c6750919583aca660c73b966853056ec94 Mon Sep 17 00:00:00 2001
From: Zhantao Tang <zhantao.tang@windriver.com>
Date: Thu, 27 Oct 2022 09:30:01 +0800
Subject: [PATCH] pkcs: fix QA error

This patch is to fix the following QA error:

 ERROR: pkcs11-hse-1.0-r0 do_package_qa: QA Issue: File /usr/bin/hse-encrypt in package pkcs11-hse-examples doesn't have GNU_HASH (didn't pass LDFLAGS?)
 *File /usr/bin/hse-encrypt in package pkcs11-hse-examples doesn't have GNU_HASH (didn't pass LDFLAGS?)**
 **File /usr/bin/hse-sysimg in package pkcs11-hse-examples doesn't have GNU_HASH (didn't pass LDFLAGS?)*
 File /usr/bin/hse-sysimg in package pkcs11-hse-examples doesn't have GNU_HASH (didn't pass LDFLAGS?) [ldflags]
 ERROR: pkcs11-hse-1.0-r0 do_package_qa: Fatal QA errors were found, failing task.

Because the new added demo apps not use the LDFLAGS when compiling, so add
LDFLAGS for them can fix the QA error.

Upstream-Status: Pending

Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 examples/Makefile | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/examples/Makefile b/examples/Makefile
index 663e984..8b0cf5d 100644
--- a/examples/Makefile
+++ b/examples/Makefile
@@ -50,16 +50,16 @@ pkcs-keyop: pkcs-keyop.c
 	$(CROSS_COMPILE)gcc $(LIBS) $(INCLUDE_KEYOP) $(CFLAGS) $^ -o $@ $(LDFLAGS)
 
 pkcs-key-provision: pkcs-key-provision.c
-	$(CROSS_COMPILE)gcc -L$(OPENSSL_DIR)/lib $(INCLUDE_LIBPKCS) $(CFLAGS) $^ -o $@ -lcrypto -ldl
+	$(CROSS_COMPILE)gcc -L$(OPENSSL_DIR)/lib $(INCLUDE_LIBPKCS) $(CFLAGS) $^ -o $@ $(LDFLAGS) -lcrypto -ldl
 
 hse-encrypt: hse-encrypt.c
-	$(CROSS_COMPILE)gcc -L$(LIBHSE_DIR) $(INCLUDE_LIBHSE) $(CFLAGS) $^ -o $@ -lhse
+	$(CROSS_COMPILE)gcc -L$(LIBHSE_DIR) $(INCLUDE_LIBHSE) $(CFLAGS) $^ -o $@ $(LDFLAGS) -lhse
 
 hse-sysimg: hse-sysimg.c
-	$(CROSS_COMPILE)gcc -L$(LIBHSE_DIR) $(INCLUDE_LIBHSE) $(CFLAGS) $^ -o $@ -lhse
+	$(CROSS_COMPILE)gcc -L$(LIBHSE_DIR) $(INCLUDE_LIBHSE) $(CFLAGS) $^ -o $@ $(LDFLAGS) -lhse
 
 hse-secboot: hse-secboot.c
-	$(CROSS_COMPILE)gcc -L$(LIBHSE_DIR) -L$(OPENSSL_DIR)/lib -I$(OPENSSL_DIR)/include $(INCLUDE_LIBHSE) $(CFLAGS) $^ -o $@ -lcrypto -lhse
+	$(CROSS_COMPILE)gcc -L$(LIBHSE_DIR) -L$(OPENSSL_DIR)/lib -I$(OPENSSL_DIR)/include $(INCLUDE_LIBHSE) $(CFLAGS) $^ -o $@ $(LDFLAGS) -lcrypto -lhse
 
 clean:
 	rm -f pkcs-keyop pkcs-key-provision hse-encrypt hse-sysimg hse-secboot
-- 
2.25.1

