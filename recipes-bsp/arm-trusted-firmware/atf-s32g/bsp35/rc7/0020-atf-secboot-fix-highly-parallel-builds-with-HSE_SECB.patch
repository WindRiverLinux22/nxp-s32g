From 8ecb1f78fa32d695cafda9a1e900d0417dc1fbf2 Mon Sep 17 00:00:00 2001
From: Vlad Pelin <vlad.pelin@nxp.com>
Date: Fri, 9 Sep 2022 10:48:46 +0300
Subject: [PATCH 20/49] atf: secboot: fix highly parallel builds with
 HSE_SECBOOT=1

Issue: ALB-9235
Upstream-Status: Pending 

Signed-off-by: Vlad Pelin <vlad.pelin@nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 plat/nxp/s32/s32_common.mk | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/plat/nxp/s32/s32_common.mk b/plat/nxp/s32/s32_common.mk
index 83f545795..d5b2d57d5 100644
--- a/plat/nxp/s32/s32_common.mk
+++ b/plat/nxp/s32/s32_common.mk
@@ -381,7 +381,8 @@ ${BL2_W_DTB_SIZE_FILE}: ${BL2_W_DTB}
 	${ECHO} "  CREATE  $@"
 	${Q}$(call hexfilesize, $<) > $@
 
-${MKIMAGE_FIP_CONF_FILE}: ${BL2_W_DTB_SIZE_FILE} ${FIP_HDR_SIZE_FILE} FORCE
+# required dependency on add_to_fip, otherwise in parallel builds might result in wrong size
+${MKIMAGE_FIP_CONF_FILE}: ${BL2_W_DTB_SIZE_FILE} ${FIP_HDR_SIZE_FILE} add_to_fip FORCE
 	${ECHO} "  CREATE  $@"
 	${Q}cp -f ${MKIMAGE_CFG} $@
 ifneq (${HSE_SECBOOT},)
-- 
2.25.1

