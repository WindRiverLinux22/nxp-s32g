From 6e4f647bbc95e7dc51236182adbe5467f43a7f62 Mon Sep 17 00:00:00 2001
From: Ghennadi Procopciuc <ghennadi.procopciuc@nxp.com>
Date: Thu, 29 Sep 2022 14:24:38 +0300
Subject: [PATCH 18/30] css: scmi: Add a macro to mark the channel as free

Issue: ALB-9298
Upstream-Status: Pending 

Signed-off-by: Ghennadi Procopciuc <ghennadi.procopciuc@nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 drivers/arm/css/scmi/scmi_private.h | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/drivers/arm/css/scmi/scmi_private.h b/drivers/arm/css/scmi/scmi_private.h
index 61437f6d7..56bea86ab 100644
--- a/drivers/arm/css/scmi/scmi_private.h
+++ b/drivers/arm/css/scmi/scmi_private.h
@@ -93,6 +93,12 @@
 				SCMI_CH_STATUS_FREE_SHIFT);		\
 	} while (0)
 
+#define SCMI_MARK_CHANNEL_FREE(status) do {				\
+	assert(!SCMI_IS_CHANNEL_FREE(status));				\
+	(status) |= (SCMI_CH_STATUS_FREE_MASK <<			\
+		     SCMI_CH_STATUS_FREE_SHIFT);			\
+	} while (0)
+
 /* Helper macros to copy arguments to the mailbox payload */
 #define SCMI_PAYLOAD_ARG1(payld_arr, arg1)				\
 		mmio_write_32((uintptr_t)&payld_arr[0], arg1)
-- 
2.17.1

