From 614dd27076bdecb81321efddffb79e5e996bfa80 Mon Sep 17 00:00:00 2001
From: Ghennadi Procopciuc <ghennadi.procopciuc@nxp.com>
Date: Thu, 22 Sep 2022 15:55:07 +0300
Subject: [PATCH 08/30] s32cc: Guard arm64 specific code

Issue: ALB-9298
Upstream-Status: Pending 

Signed-off-by: Ghennadi Procopciuc <ghennadi.procopciuc@nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 plat/nxp/s32/include/s32_mc_rgm.h | 2 +-
 plat/nxp/s32/s32_mc_me.c          | 9 ++++++---
 2 files changed, 7 insertions(+), 4 deletions(-)

diff --git a/plat/nxp/s32/include/s32_mc_rgm.h b/plat/nxp/s32/include/s32_mc_rgm.h
index 5eaa67a95..9e0d7267c 100644
--- a/plat/nxp/s32/include/s32_mc_rgm.h
+++ b/plat/nxp/s32/include/s32_mc_rgm.h
@@ -8,7 +8,7 @@
 #define __S32_MC_RGM_H__
 
 #include <lib/utils_def.h>
-#include <lib/libc/stdint.h>
+#include <stdint.h>
 
 #define S32_MC_RGM_BASE_ADDR		0x40078000ul
 #define S32_MC_RGM_SIZE				0x1000ul
diff --git a/plat/nxp/s32/s32_mc_me.c b/plat/nxp/s32/s32_mc_me.c
index 91befdd6a..dcf142597 100644
--- a/plat/nxp/s32/s32_mc_me.c
+++ b/plat/nxp/s32/s32_mc_me.c
@@ -1,9 +1,9 @@
 /*
- * Copyright 2019-2021 NXP
+ * Copyright 2019-2022 NXP
  *
  * SPDX-License-Identifier: BSD-3-Clause
  */
-#include <utils_def.h>
+#include <lib/utils_def.h>
 #include <lib/mmio.h>
 #include <common/debug.h>
 #include "s32_mc_rgm.h"
@@ -248,7 +248,7 @@ static void enable_a53_core_cluster(uint32_t core)
 static void set_core_high_addr(uintptr_t addr, uint32_t core)
 {
 	const struct a53_haddr_mapping *map;
-	uint32_t addr_hi, reg_val, field_off, reg_off;
+	uint32_t addr_hi = 0, reg_val, field_off, reg_off;
 	size_t size;
 
 	map = s32_get_a53_haddr_mappings(&size);
@@ -259,7 +259,10 @@ static void set_core_high_addr(uintptr_t addr, uint32_t core)
 	reg_off = map[core].reg;
 	field_off = map[core].field_off;
 
+#ifdef __aarch64__
 	addr_hi = (uint32_t)(addr >> 32);
+#endif
+
 	reg_val = mmio_read_32(GPR_BASE_ADDR + reg_off);
 
 	reg_val |= ((addr_hi & CA53_RVBARADDR_MASK) << field_off);
-- 
2.17.1

