From 4179a109730f50044e5a419310787b5c4b804d7c Mon Sep 17 00:00:00 2001
From: Dan Nica <dan.nica@nxp.com>
Date: Thu, 21 Jul 2022 07:58:12 +0300
Subject: [PATCH 12/42] s32: mmc: Set INT_SIGNAL_EN in s32_mmc_init, not on
 each command

Issue: ALB-9078
Upstream-Status: Pending 

Signed-off-by: Dan Nica <dan.nica@nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 drivers/nxp/s32/mmc/s32_mmc.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/nxp/s32/mmc/s32_mmc.c b/drivers/nxp/s32/mmc/s32_mmc.c
index 5b41f0c72..45c8964ef 100644
--- a/drivers/nxp/s32/mmc/s32_mmc.c
+++ b/drivers/nxp/s32/mmc/s32_mmc.c
@@ -182,6 +182,7 @@ static void s32_mmc_init(void)
 	s32_mmc_set_clk(IDENTIFICATION_MODE_FREQUENCY);
 
 	mmio_write_32(USDHC_INT_STATUS_EN, INT_STATUS_EN_ENABLEMASK);
+	mmio_write_32(USDHC_INT_SIGNAL_EN, 0);
 	mmio_write_32(USDHC_PROT_CTRL, PROT_CTRL_EMODE_LE);
 
 	regdata = mmio_read_32(USDHC_SYS_CTRL);
@@ -203,7 +204,6 @@ static int s32_mmc_send_cmd(struct mmc_cmd *cmd)
 	while (mmio_read_32(USDHC_PRES_STATE) &
 	       (PRES_STATE_CDIHB | PRES_STATE_CIHB | PRES_STATE_DLA))
 		;
-	mmio_write_32(USDHC_INT_SIGNAL_EN, 0);
 
 	cmd_xfr_typ = CMD_XFR_TYP_CMDINX(cmd->cmd_idx);
 	mix_ctrl = mmio_read_32(USDHC_MIX_CTRL);
-- 
2.17.1

