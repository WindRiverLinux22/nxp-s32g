From 0be36817efac38f277dd9f85bbdc2e93acc28721 Mon Sep 17 00:00:00 2001
From: Ghennadi Procopciuc <ghennadi.procopciuc@nxp.com>
Date: Thu, 14 Jul 2022 09:56:02 +0300
Subject: [PATCH 02/42] clk: s32: Panic if failed to initialize clocks

Issue: ALB-8357
Upstream-Status: Pending 

Signed-off-by: Ghennadi Procopciuc <ghennadi.procopciuc@nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 drivers/nxp/s32/clk/clk.c | 13 +++++++++----
 1 file changed, 9 insertions(+), 4 deletions(-)

diff --git a/drivers/nxp/s32/clk/clk.c b/drivers/nxp/s32/clk/clk.c
index 5b6a6c207..8af9bcf4b 100644
--- a/drivers/nxp/s32/clk/clk.c
+++ b/drivers/nxp/s32/clk/clk.c
@@ -8,6 +8,7 @@
 #include <errno.h>
 #include <libfdt.h>
 #include <memory_pool.h>
+#include <plat/common/platform.h>
 #include <s32_dt.h>
 
 /*
@@ -74,25 +75,29 @@ void dt_clk_init(void)
 
 	if (dt_open_and_check() < 0) {
 		ERROR("Invalid DTB\n");
-		return;
+		goto panic;
 	}
 
 	if (fdt_get_address(&fdt) == 0) {
 		ERROR("Failed to get FDT address\n");
-		return;
+		goto panic;
 	}
 
 	ret = dt_init_fixed_clk(fdt);
 	if (ret) {
 		ERROR("Failed to initialize fixed clocks\n");
-		return;
+		goto panic;
 	}
 
 	ret = dt_init_plat_clk(fdt);
 	if (ret) {
 		ERROR("Failed to initialize platform clocks\n");
-		return;
+		goto panic;
 	}
+
+	return;
+panic:
+	plat_panic_handler();
 }
 
 int get_clk(uint32_t drv_id, uint32_t clk_id, struct clk *clock)
-- 
2.17.1

