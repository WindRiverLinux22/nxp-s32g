From af1958252c01f2d55b8e036f4a565eb5aeadbc92 Mon Sep 17 00:00:00 2001
From: Ciprian Costea <ciprianmarian.costea@nxp.com>
Date: Tue, 28 Jun 2022 10:41:33 +0300
Subject: [PATCH 2/6] s32cc: dts: qspi: Add QSPI partitions

Issue: ALB-9014
Upstream-Status: Pending 

Signed-off-by: Ciprian Costea <ciprianmarian.costea@nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 fdts/s32cc-nxp-flash-macronix.dtsi | 52 ++++++++++++++++++++++++++++++
 fdts/s32g-nxp-flash-macronix.dtsi  | 15 +++++++++
 fdts/s32g.dtsi                     | 10 ------
 fdts/s32gxxxa-evb.dtsi             |  1 +
 fdts/s32gxxxa-rdb.dtsi             |  1 +
 fdts/s32r45-evb.dts                | 10 ++----
 6 files changed, 71 insertions(+), 18 deletions(-)
 create mode 100644 fdts/s32cc-nxp-flash-macronix.dtsi
 create mode 100644 fdts/s32g-nxp-flash-macronix.dtsi

diff --git a/fdts/s32cc-nxp-flash-macronix.dtsi b/fdts/s32cc-nxp-flash-macronix.dtsi
new file mode 100644
index 000000000..7072f58cc
--- /dev/null
+++ b/fdts/s32cc-nxp-flash-macronix.dtsi
@@ -0,0 +1,52 @@
+// SPDX-License-Identifier: (GPL-2.0+ OR BSD-3-Clause)
+/*
+ * Copyright 2022 NXP
+ */
+
+&qspi {
+	macronix_memory: mx25uw51245g@0 {
+		#address-cells = <1>;
+		#size-cells = <1>;
+		compatible = "jedec,spi-nor";
+		spi-max-frequency = <200000000>;
+		spi-tx-bus-width = <8>;
+		spi-rx-bus-width = <8>;
+		reg = <0>;
+
+		partitions {
+			compatible = "fixed-partitions";
+			#address-cells = <1>;
+			#size-cells = <1>;
+
+			flashimage@0 {
+				label = "Flash-Image";
+				reg = <0x0 0x4000000>;
+			};
+
+			boot@0 {
+				label = "FIP";
+				reg = <0x0 0x1e0000>;
+			};
+
+			boot-env@1e0000 {
+				label = "U-Boot-Env";
+				reg = <0x1e0000 0x10000>;
+			};
+
+			kernel@1f0000 {
+				label = "Kernel";
+				reg = <0x1f0000 0xe00000>;
+			};
+
+			dtb@ff0000 {
+				label = "DTB";
+				reg = <0xff0000 0x100000>;
+			};
+
+			rootfs@10f0000 {
+				label = "Rootfs";
+				reg = <0x10f0000 0x1f10000>;
+			};
+		};
+	};
+};
diff --git a/fdts/s32g-nxp-flash-macronix.dtsi b/fdts/s32g-nxp-flash-macronix.dtsi
new file mode 100644
index 000000000..b75b51eae
--- /dev/null
+++ b/fdts/s32g-nxp-flash-macronix.dtsi
@@ -0,0 +1,15 @@
+// SPDX-License-Identifier: (GPL-2.0+ OR BSD-3-Clause)
+/*
+ * Copyright 2022 NXP
+ */
+
+#include "s32cc-nxp-flash-macronix.dtsi"
+
+&macronix_memory {
+	partitions {
+		pfe@3000000 {
+			label = "PFE-Firmware";
+			reg = <0x3000000 0x1000000>;
+		};
+	};
+};
diff --git a/fdts/s32g.dtsi b/fdts/s32g.dtsi
index be36fcadc..98160fdcd 100644
--- a/fdts/s32g.dtsi
+++ b/fdts/s32g.dtsi
@@ -288,16 +288,6 @@
 &qspi {
 	compatible = "nxp,s32g-qspi", "nxp,s32cc-qspi";
 	status = "okay";
-
-	mx25uw51245g@0 {
-		#address-cells = <1>;
-		#size-cells = <1>;
-		compatible = "jedec,spi-nor";
-		spi-max-frequency = <200000000>;
-		spi-tx-bus-width = <8>;
-		spi-rx-bus-width = <8>;
-		reg = <0>;
-	};
 };
 
 &usdhc0 {
diff --git a/fdts/s32gxxxa-evb.dtsi b/fdts/s32gxxxa-evb.dtsi
index 0fda509ef..ba4985149 100644
--- a/fdts/s32gxxxa-evb.dtsi
+++ b/fdts/s32gxxxa-evb.dtsi
@@ -4,6 +4,7 @@
  */
 
 #include <dt-bindings/gpio/gpio.h>
+#include "s32g-nxp-flash-macronix.dtsi"
 
 / {
 	aliases {
diff --git a/fdts/s32gxxxa-rdb.dtsi b/fdts/s32gxxxa-rdb.dtsi
index 4e6abd46e..e228f1a06 100644
--- a/fdts/s32gxxxa-rdb.dtsi
+++ b/fdts/s32gxxxa-rdb.dtsi
@@ -4,6 +4,7 @@
  */
 
 #include <dt-bindings/gpio/gpio.h>
+#include "s32g-nxp-flash-macronix.dtsi"
 
 &usdhc0 {
 	/* By default sd0 pins were able to work at 100Mhz and 200Mhz */
diff --git a/fdts/s32r45-evb.dts b/fdts/s32r45-evb.dts
index 69cd73864..95c09733b 100644
--- a/fdts/s32r45-evb.dts
+++ b/fdts/s32r45-evb.dts
@@ -9,22 +9,16 @@
 
 /dts-v1/;
 #include "s32r45.dtsi"
+#include "s32cc-nxp-flash-macronix.dtsi"
 
 &qspi {
 	compatible = "nxp,s32r45-qspi", "nxp,s32cc-qspi";
 	pinctrl-0 = <&pinctrl0_qspi>;
 	pinctrl-names = "default";
-	spi-max-frequency = <133333333>;
 	status = "okay";
 
 	mx25uw51245g@0 {
-		#address-cells = <1>;
-		#size-cells = <1>;
-		compatible = "jedec,spi-nor";
-		spi-max-frequency = <200000000>;
-		spi-tx-bus-width = <8>;
-		spi-rx-bus-width = <8>;
-		reg = <0>;
+		spi-max-frequency = <133333333>;
 	};
 };
 
-- 
2.17.1

