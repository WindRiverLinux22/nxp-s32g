From 3844d6ff956e9f021fcabfcf2518e34cb2083413 Mon Sep 17 00:00:00 2001
From: Ghennadi Procopciuc <ghennadi.procopciuc@nxp.com>
Date: Tue, 28 Jun 2022 11:42:03 +0300
Subject: [PATCH 28/33] misc: sja1105: Replace fdt calls with ofnode
 alternatives

Issue: ALB-9010
Upstream-Status: Pending 

Signed-off-by: Ghennadi Procopciuc <ghennadi.procopciuc@nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 drivers/misc/sja1105.c | 15 ++++++++-------
 1 file changed, 8 insertions(+), 7 deletions(-)

diff --git a/drivers/misc/sja1105.c b/drivers/misc/sja1105.c
index 15c0c3e7ba..65692c1f39 100644
--- a/drivers/misc/sja1105.c
+++ b/drivers/misc/sja1105.c
@@ -2,12 +2,12 @@
 /*
  * Copyright 2017-2018, 2020-2022 NXP
  */
-#include "sja1105_ll.h"
 #include <common.h>
+#include <spi.h>
 #include <dm/device.h>
 #include <dm/uclass.h>
 #include <linux/errno.h>
-#include <spi.h>
+#include "sja1105_ll.h"
 
 #define SJA1105_VAL_DEVICEID_1_1	0xAE00030EUL
 
@@ -910,18 +910,19 @@ static int get_sja1105_device(struct udevice **dev, struct sja_parms *sjap)
 {
 	struct udevice *parent;
 	size_t i;
-	int off, ret;
+	int ret;
+	ofnode node;
 
 	for (i = 0; i < ARRAY_SIZE(sja1105_ids); i++) {
 		if (!sja1105_ids[i].compatible)
 			continue;
 
-		off = fdt_node_offset_by_compatible(gd->fdt_blob, -1,
-						    sja1105_ids[i].compatible);
-		if (off == -FDT_ERR_NOTFOUND)
+		node = ofnode_by_compatible(ofnode_null(),
+					    sja1105_ids[i].compatible);
+		if (!ofnode_valid(node))
 			continue;
 
-		ret = uclass_get_device_by_of_offset(UCLASS_MISC, off, dev);
+		ret = uclass_get_device_by_ofnode(UCLASS_MISC, node, dev);
 		if (ret)
 			continue;
 
-- 
2.17.1

