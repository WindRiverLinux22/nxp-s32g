From 4f1a9c8be6dc9b6336aefd36f2dff7142068348a Mon Sep 17 00:00:00 2001
From: Ghennadi Procopciuc <ghennadi.procopciuc@nxp.com>
Date: Tue, 28 Jun 2022 12:30:38 +0300
Subject: [PATCH 32/33] spi: fsl_dspi: Use dev API instead of fdtdec calls

Issue: ALB-9010
Upstream-Status: Pending 

Signed-off-by: Ghennadi Procopciuc <ghennadi.procopciuc@nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 drivers/spi/fsl_dspi.c | 13 +++++--------
 1 file changed, 5 insertions(+), 8 deletions(-)

diff --git a/drivers/spi/fsl_dspi.c b/drivers/spi/fsl_dspi.c
index de2de4ccd6..da9237a667 100644
--- a/drivers/spi/fsl_dspi.c
+++ b/drivers/spi/fsl_dspi.c
@@ -18,7 +18,6 @@
 #include <spi.h>
 #include <malloc.h>
 #include <asm/io.h>
-#include <fdtdec.h>
 #ifndef CONFIG_M68K
 #include <asm/arch/clock.h>
 #endif
@@ -769,24 +768,22 @@ static int fsl_dspi_ofdata_to_platdata(struct udevice *bus)
 {
 	fdt_addr_t addr;
 	struct fsl_dspi_platdata *plat = bus->platdata;
-	const void *blob = gd->fdt_blob;
-	int node = dev_of_offset(bus);
 
-	if (fdtdec_get_bool(blob, node, "big-endian"))
+	if (dev_read_bool(bus, "big-endian"))
 		plat->flags |= DSPI_FLAG_REGMAP_ENDIAN_BIG;
 
 	plat->num_chipselect =
-		fdtdec_get_int(blob, node, "num-cs", FSL_DSPI_MAX_CHIPSELECT);
+		dev_read_u32_default(bus, "num-cs", FSL_DSPI_MAX_CHIPSELECT);
 
-	addr = devfdt_get_addr(bus);
+	addr = dev_read_addr(bus);
 	if (addr == FDT_ADDR_T_NONE) {
 		debug("DSPI: Can't get base address or size\n");
 		return -ENOMEM;
 	}
 	plat->regs_addr = addr;
 
-	plat->speed_hz = fdtdec_get_int(blob,
-			node, "spi-max-frequency", FSL_DSPI_DEFAULT_SCK_FREQ);
+	plat->speed_hz = dev_read_u32_default(bus, "spi-max-frequency",
+					      FSL_DSPI_DEFAULT_SCK_FREQ);
 
 	debug("DSPI: regs=%pa, max-frequency=%d, endianess=%s, num-cs=%d\n",
 	      &plat->regs_addr, plat->speed_hz,
-- 
2.17.1

